# 🚀 造价审计系统 - 阿里云部署指南

> 👋 你好!欢迎使用造价审计系统部署包

---

## ⚡ 快速开始 (5分钟了解)

### 我是谁?
- 😊 **完全不懂技术的新手** → 请看 [新手部署图解教程.md](./新手部署图解教程.md)
- 🤔 **有一点技术基础** → 请看 [阿里云部署指南.md](./阿里云部署指南.md)
- 💪 **技术人员或运维** → 请看 [部署快速参考.md](./部署快速参考.md)

### 我想做什么?
- 🎯 **第一次部署系统** → 按顺序看: ① 新手教程 → ② 详细指南 → ③ 执行部署
- 🔧 **系统已部署,日常维护** → 直接看: [部署快速参考.md](./部署快速参考.md)
- 🆘 **遇到问题需要排查** → 查看: [常见问题解决方案](#常见问题快速解决)
- 📚 **了解所有资源** → 查看: [README-部署.md](./README-部署.md)

---

## 📦 部署资源包内容

### 📖 文档 (共5份)

```
📄 新手部署图解教程.md          ⭐⭐⭐⭐⭐ 强烈推荐新手阅读
   ├─ 图文并茂,通俗易懂
   ├─ 每一步都有详细说明
   └─ 包含完整的问题排查流程

📄 阿里云部署指南.md            ⭐⭐⭐⭐⭐ 最详细的部署文档
   ├─ 8个详细步骤,从购买到上线
   ├─ 包含所有配置细节
   ├─ 域名和HTTPS配置教程
   └─ 完整的故障排查指南

📄 部署快速参考.md              ⭐⭐⭐⭐ 日常维护必备
   ├─ 常用命令速查表
   ├─ 故障排查快速指南
   └─ 一分钟找到需要的命令

📄 README-部署.md              ⭐⭐⭐ 资源总览
   ├─ 所有文档和脚本说明
   ├─ 部署检查清单
   └─ 常见问题FAQ

📄 生产环境部署指南.md          ⭐⭐ 技术参考
   ├─ 之前的部署文档
   └─ 可作为补充参考
```

### 🛠️ 脚本 (共3个核心脚本)

```
🔧 deploy-to-aliyun.sh          ⭐⭐⭐⭐⭐ 一键部署脚本
   ├─ 自动安装Docker环境
   ├─ 自动配置生产环境
   ├─ 自动构建和启动所有服务
   └─ 使用方法: ./deploy-to-aliyun.sh

💾 backup-data.sh               ⭐⭐⭐⭐⭐ 数据备份脚本
   ├─ 备份数据库
   ├─ 备份上传文件
   ├─ 自动清理旧备份
   └─ 使用方法: ./backup-data.sh

🏥 health-check.sh              ⭐⭐⭐⭐ 健康检查脚本
   ├─ 检查所有服务状态
   ├─ 检查资源使用情况
   ├─ 检查错误日志
   └─ 使用方法: ./health-check.sh
```

---

## 🎯 部署流程图

```
开始部署
   ↓
┌─────────────────────┐
│ 1. 购买阿里云服务器  │ (10分钟)
│   - 选择配置         │
│   - 设置密码         │
│   - 配置安全组       │
└─────────────────────┘
   ↓
┌─────────────────────┐
│ 2. 连接到服务器      │ (5分钟)
│   - Windows: Xshell │
│   - Mac: 终端        │
└─────────────────────┘
   ↓
┌─────────────────────┐
│ 3. 上传项目代码      │ (10分钟)
│   - Windows: WinSCP │
│   - Mac: scp命令     │
│   - 上传到 /opt/     │
└─────────────────────┘
   ↓
┌─────────────────────┐
│ 4. 一键部署          │ (15分钟)
│ ./deploy-to-aliyun.sh│
│   - 自动安装环境     │
│   - 自动构建镜像     │
│   - 自动启动服务     │
└─────────────────────┘
   ↓
┌─────────────────────┐
│ 5. 测试访问          │ (5分钟)
│   - 访问前端页面     │
│   - 登录系统         │
│   - 功能测试         │
└─────────────────────┘
   ↓
部署完成! 🎉
```

**总耗时**: 约45分钟 (首次部署)

---

## 📋 部署前准备清单

### 需要准备的东西

```
☐ 阿里云账号 (需要实名认证)
☐ 预算: 100-500元/月 (根据配置)
☐ 域名 (可选,如果需要HTTPS)
☐ 本地项目代码
☐ 1-2小时时间
☐ 稳定的网络连接
```

### 需要安装的软件

**Windows用户**:
```
☐ Xshell (SSH连接工具) - 免费
☐ WinSCP (文件传输工具) - 免费
```

**Mac用户**:
```
☐ 终端 (系统自带)
☐ FileZilla (可选,如果不想用命令行)
```

### 需要记录的信息

```
┌─────────────────────────────┐
│ 服务器信息                  │
├─────────────────────────────┤
│ 公网IP: _________________   │
│ root密码: _______________   │
│ 地域: ___________________   │
└─────────────────────────────┘

┌─────────────────────────────┐
│ 系统密码 (部署后生成)       │
├─────────────────────────────┤
│ 数据库密码: _____________   │
│ Redis密码: _______________  │
│ 管理员密码: _____________   │
└─────────────────────────────┘
```

---

## 🚀 三步快速部署

### 步骤1: 购买服务器

访问: https://www.aliyun.com/

**推荐配置**:
- CPU: 4核
- 内存: 8GB
- 硬盘: 100GB SSD
- 系统: **Ubuntu 22.04 64位** (重要!)
- 带宽: 5Mbps

**最低配置**:
- CPU: 2核
- 内存: 4GB
- 硬盘: 40GB SSD
- 系统: **Ubuntu 22.04 64位**
- 带宽: 3Mbps

**别忘了**:
- ✅ 勾选"分配公网IP"
- ✅ 设置root密码并记录
- ✅ 配置安全组开放端口: 22, 80, 443, 8000

### 步骤2: 上传代码

**Windows**:
1. 下载安装 WinSCP
2. 连接服务器 (IP + root密码)
3. 拖拽 `uma-audit5` 文件夹到 `/opt/` 目录

**Mac**:
```bash
cd ~/Documents/code/
scp -r uma-audit5 root@你的IP:/opt/
```

### 步骤3: 一键部署

**SSH连接服务器后执行**:
```bash
cd /opt/uma-audit5
./deploy-to-aliyun.sh
```

按照提示输入信息,等待部署完成!

---

## ✅ 部署成功的标志

### 1. 命令行显示

```
======================================
  部署完成! 🎉
======================================

访问信息:
----------------------------------------
前端地址: http://你的IP
后端API: http://你的IP:8000/docs
```

### 2. 浏览器访问

访问 `http://你的服务器IP` 能看到登录页面:

```
┌─────────────────────┐
│  造价材料审计系统   │
│                     │
│  用户名: [______]   │
│  密码:   [______]   │
│                     │
│     [  登录  ]      │
└─────────────────────┘
```

### 3. 服务状态正常

```bash
docker-compose -f docker-compose.prod.yml ps

# 显示:
uma_audit_backend_prod    Up
uma_audit_db_prod         Up (healthy)
uma_audit_frontend_prod   Up
uma_audit_redis_prod      Up (healthy)
```

**看到以上3个标志,恭喜部署成功!** 🎉

---

## 🔧 日常维护速查

### 每天要做

```bash
# 健康检查 (1分钟)
./health-check.sh
```

### 每周要做

```bash
# 1. 检查备份 (1分钟)
ls -lh /opt/backups/uma-audit/

# 2. 查看日志 (2分钟)
docker-compose -f docker-compose.prod.yml logs | grep -i error

# 3. 清理空间 (如果需要)
docker system prune -a
```

### 每月要做

```bash
# 1. 手动备份 (3分钟)
./backup-data.sh

# 2. 系统更新 (5分钟)
apt update && apt upgrade -y

# 3. 检查SSL证书 (1分钟,如果配置了HTTPS)
certbot certificates
```

---

## 🆘 常见问题快速解决

### ❌ 问题1: 部署脚本运行失败

```bash
# 检查是否有执行权限
ls -l deploy-to-aliyun.sh

# 如果没有x权限,添加
chmod +x deploy-to-aliyun.sh

# 重新运行
./deploy-to-aliyun.sh
```

### ❌ 问题2: 网站无法访问

```bash
# 1. 检查服务是否运行
docker ps

# 2. 检查防火墙
ufw status

# 3. 检查阿里云安全组
# 登录阿里云控制台 → ECS → 安全组 → 检查80端口是否开放

# 4. 重启服务
docker-compose -f docker-compose.prod.yml restart
```

### ❌ 问题3: Docker命令无法执行

```bash
# 安装Docker
curl -fsSL https://get.docker.com | bash

# 启动Docker
systemctl start docker
systemctl enable docker

# 验证安装
docker --version
```

### ❌ 问题4: 容器启动失败

```bash
# 查看详细日志
docker-compose -f docker-compose.prod.yml logs

# 重新构建
docker-compose -f docker-compose.prod.yml down
docker-compose -f docker-compose.prod.yml up -d --build
```

### ❌ 问题5: 磁盘空间不足

```bash
# 查看磁盘使用
df -h

# 清理Docker
docker system prune -a --volumes

# 清理日志
find ./backend/logs -name "*.log" -mtime +7 -delete

# 清理旧备份
find /opt/backups -mtime +30 -delete
```

---

## 📞 获取帮助的步骤

### 1. 查看文档

```
遇到问题
   ↓
查看本文档的常见问题
   ↓
查看详细部署指南
   ↓
查看快速参考手册
```

### 2. 收集信息

```bash
# 生成诊断报告
cat > /tmp/diagnostic.txt << EOF
系统信息: $(uname -a)
Docker版本: $(docker --version)
容器状态: $(docker ps -a)
资源使用: $(free -h)
磁盘空间: $(df -h)
最近日志: $(docker-compose -f docker-compose.prod.yml logs --tail=50)
EOF

# 查看报告
cat /tmp/diagnostic.txt
```

### 3. 查看日志

```bash
# 查看所有日志
docker-compose -f docker-compose.prod.yml logs

# 查看错误
docker-compose -f docker-compose.prod.yml logs | grep -i error

# 实时查看
docker-compose -f docker-compose.prod.yml logs -f
```

---

## 🎯 下一步行动

### 部署完成后立即做

- [ ] 登录系统测试
- [ ] 创建测试项目
- [ ] 上传测试材料
- [ ] 测试AI分析功能
- [ ] 设置自动备份

### 一周内完成

- [ ] 邀请用户试用
- [ ] 收集使用反馈
- [ ] 配置域名 (可选)
- [ ] 配置HTTPS (推荐)

### 长期运维

- [ ] 定期检查系统健康
- [ ] 定期查看备份
- [ ] 定期更新系统
- [ ] 定期清理日志
- [ ] 定期优化性能

---

## 💡 重要提示

### ⚠️ 安全注意事项

1. **保管好密码**
   - root密码
   - 数据库密码
   - Redis密码
   - 管理员密码

2. **定期备份**
   - 设置自动备份
   - 异地存储备份
   - 定期测试恢复

3. **配置HTTPS**
   - 申请SSL证书
   - 保护数据传输
   - 提升用户信任

4. **限制访问**
   - 只开放必要端口
   - 使用强密码
   - 定期更新系统

### 📝 操作建议

1. **不确定时先备份**
   ```bash
   ./backup-data.sh
   ```

2. **操作前先测试**
   - 在测试环境验证
   - 查看文档确认步骤
   - 准备回滚方案

3. **遇到问题不要慌**
   - 查看日志定位问题
   - 参考文档找解决方案
   - 记录问题便于后续

4. **重要操作要记录**
   - 记录修改内容
   - 记录操作时间
   - 记录操作原因

---

## 📚 文档阅读建议

### 🌟 新手必读路线

```
第1步: 🚀开始部署-请先看我.md (当前文档)
   ↓  了解全貌,5分钟快速了解

第2步: 新手部署图解教程.md
   ↓  详细图解,边看边操作

第3步: 阿里云部署指南.md
   ↓  深入学习,理解每个步骤

第4步: 部署快速参考.md
   ↓  日常使用,快速查命令
```

### 💪 进阶学习路线

```
基础: 完成系统部署
   ↓
进阶: 配置域名和HTTPS
   ↓
高级: 性能优化和监控
   ↓
专家: 集群部署和负载均衡
```

---

## 🎉 结语

恭喜你准备开始部署造价审计系统!

**记住这4点**:
1. 📖 **多看文档** - 遇到问题先查文档
2. 💾 **定期备份** - 数据安全最重要
3. 🔍 **查看日志** - 日志是最好的老师
4. 🆘 **不懂就问** - 记录问题寻求帮助

现在,选择适合你的教程开始部署吧!

---

## 📖 快速导航

- 🌟 [新手图解教程](./新手部署图解教程.md) - 零基础入门
- 📖 [详细部署指南](./阿里云部署指南.md) - 完整步骤
- ⚡ [快速参考手册](./部署快速参考.md) - 命令速查
- 📚 [资源总览](./README-部署.md) - 了解所有资源

---

**文档版本**: v1.0
**创建时间**: 2025年1月20日
**适用系统**: Ubuntu 22.04 + Docker
**维护者**: Claude AI Assistant

**祝你部署顺利! 🚀**
