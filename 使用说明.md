# 造价材料审计系统 - 使用说明

## 📋 系统简介

造价材料审计系统是一个基于AI的智能审计平台，用于识别和分析项目材料价格的合理性。

**技术栈**: Python FastAPI + Vue.js + PostgreSQL + Redis + Docker

---

## 🚀 快速开始

### 前提条件

确保已安装：
- Docker Desktop (必需)
- macOS 系统

### 一键启动

在项目根目录执行：

```bash
./启动系统.sh
```

系统将自动：
1. 检查Docker运行状态
2. 启动数据库和后端服务（约30秒）
3. 启动前端界面（约10秒）
4. 自动打开浏览器

### 访问系统

- **前端界面**: http://localhost:3000
- **API文档**: http://localhost:8000/docs
- **健康检查**: http://localhost:8000/health

### 登录信息

- **用户名**: `admin`
- **密码**: `admin123`

---

## 🛠️ 常用操作

### 1. 启动系统

```bash
./启动系统.sh
```

**说明**: 启动完整系统（后端 + 前端）

### 2. 停止系统

```bash
./停止系统.sh
```

**说明**: 完全停止所有服务

### 3. 检查状态

```bash
./检查状态.sh
```

**说明**: 查看当前系统运行状态和服务健康情况

### 4. 重启系统

```bash
./重启系统.sh
```

**说明**: 重启整个系统（先停止再启动）

---

## 📊 服务说明

### 后端服务（Docker容器）

- **PostgreSQL数据库**: 端口 5432
- **Redis缓存**: 端口 6379
- **FastAPI后端**: 端口 8000

### 前端服务

- **Vue.js界面**: 端口 3000
- **Vite开发服务器**: 热重载支持

---

## 🔍 故障排查

### 问题1: Docker未运行

**错误信息**: `❌ Docker未运行，请先启动Docker Desktop`

**解决方法**:
1. 打开Docker Desktop应用
2. 等待Docker完全启动
3. 重新运行启动脚本

### 问题2: 端口被占用

**错误信息**: `Port 3000 is already in use` 或 `Port 8000 is already in use`

**解决方法**:
```bash
# 查看端口占用
lsof -i :3000
lsof -i :8000

# 停止占用进程
kill <PID>

# 或使用停止脚本
./停止系统.sh
```

### 问题3: 后端服务启动失败

**解决方法**:
```bash
# 查看后端日志
docker compose logs backend

# 重启后端服务
docker compose restart backend
```

### 问题4: 前端无法访问后端

**检查步骤**:
1. 确认后端健康状态: `curl http://localhost:8000/health`
2. 检查浏览器控制台错误信息
3. 确认.env配置文件中的后端地址正确

---

## 📁 项目结构

```
uma-audit5/
├── backend/              # 后端代码
│   ├── app/             # 应用主目录
│   ├── main.py          # 入口文件
│   └── requirements.txt # Python依赖
├── frontend/            # 前端代码
│   ├── src/            # 源代码
│   ├── package.json    # Node依赖
│   └── vite.config.js  # Vite配置
├── docker-compose.yml   # Docker编排配置
├── .env                 # 环境变量
├── 启动系统.sh          # 启动脚本
├── 停止系统.sh          # 停止脚本
├── 检查状态.sh          # 状态检查脚本
└── 使用说明.md          # 本文档
```

---

## 💡 开发提示

### 查看实时日志

```bash
# 查看所有服务日志
docker compose logs -f

# 查看特定服务日志
docker compose logs -f backend
docker compose logs -f postgres
docker compose logs -f redis
```

### 进入容器调试

```bash
# 进入后端容器
docker compose exec backend bash

# 进入数据库容器
docker compose exec postgres psql -U postgres -d uma_audit
```

### 重建容器

```bash
# 停止并删除容器
docker compose down

# 重新构建并启动
docker compose up -d --build
```

---

## 🔐 安全说明

**重要**: 当前系统使用的是开发环境配置：

- 默认管理员密码: `admin123`
- 数据库密码在.env文件中明文存储
- DEBUG模式已启用

**建议**:
- 生产环境请修改所有默认密码
- 使用环境变量管理敏感信息
- 关闭DEBUG模式

---

## 📞 帮助与支持

如有问题，请检查：

1. **系统状态**: 运行 `./检查状态.sh`
2. **日志信息**: 运行 `docker compose logs`
3. **文档**: 查看 `CLAUDE.md` 了解开发进度
4. **API文档**: 访问 http://localhost:8000/docs

---

## 📝 更新日志

**2025-10-22**
- ✅ 创建启动/停止/检查脚本
- ✅ 清理测试和部署文件
- ✅ 修复admin用户创建问题
- ✅ 完善使用文档

---

**祝使用愉快！** 🎉
